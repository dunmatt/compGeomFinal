<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <title>Comp 163 Final Project</title>
  <link rel="stylesheet" type="text/css" href="style.css"/>
  <script type="text/javascript" src="d3.v3.min.js" charset="utf-8"></script>
</head>
<body>
  <h1>Planar Point Location</h1>
  <script type="text/javascript" src="redblack.js" charset="utf-8"></script>
  <script type="text/javascript" src="graphEditor.js" charset="utf-8"></script>
  <script type="text/javascript" src="lineSegment.js" charset="utf-8"></script>

  <h3>Directions:</h3>
  <ol>
  	<li>Click to place points, drag to move points around</li>
  	<li>Shift + Drag to create edges (planar graphs only)</li>
  	<li>Ctrl + Click to delete points (and their edges)</li>
  	<li>When you're happy with your graph click "Toggle Query Mode" and move the mouse (which represents a query point) around.</li>
  	<li>Press 'a' in Query Mode for a debugging dump of the fully persistent red black tree.</li>
    <li>Make sure to make the graph is crazy enough that some time slabs contain many (>3) edges, otherwise the binary search tree won't look like much.</li>
  </ol>
  <h3>Ok, so that's great, but what am I looking at?</h3>
  <div class="p">
  <svg width="600" height="400" class="editMode right"><g><line x1="45" x2="45" y1="0" y2="400" class="slabWall"></line><line x1="80" x2="80" y1="0" y2="400" class="slabWall"></line><line x1="141" x2="141" y1="0" y2="400" class="slabWall"></line><line x1="169" x2="169" y1="0" y2="400" class="slabWall"></line><line x1="260" x2="260" y1="0" y2="400" class="slabWall"></line><line x1="209" x2="209" y1="0" y2="400" class="slabWall"></line><line x1="133" x2="133" y1="0" y2="400" class="slabWall"></line><line x1="266" x2="266" y1="0" y2="400" class="slabWall"></line><line x1="262" x2="262" y1="0" y2="400" class="slabWall"></line><line x1="340" x2="340" y1="0" y2="400" class="slabWall"></line><line x1="322" x2="322" y1="0" y2="400" class="slabWall"></line><line x1="414" x2="414" y1="0" y2="400" class="slabWall"></line><line x1="348" x2="348" y1="0" y2="400" class="slabWall"></line><line x1="288" x2="288" y1="0" y2="400" class="slabWall"></line><line x1="289" x2="289" y1="0" y2="400" class="slabWall"></line><line x1="417" x2="417" y1="0" y2="400" class="slabWall"></line><line x1="310" x2="310" y1="0" y2="400" class="slabWall"></line><line x1="449" x2="449" y1="0" y2="400" class="slabWall"></line><line x1="387" x2="387" y1="0" y2="400" class="slabWall"></line><line x1="513" x2="513" y1="0" y2="400" class="slabWall"></line><line x1="433" x2="433" y1="0" y2="400" class="slabWall"></line><line x1="586" x2="586" y1="0" y2="400" class="slabWall"></line></g><g><line x1="141" y1="170.125" x2="45" y2="161.125"></line><line x1="45" y1="161.125" x2="80" y2="211.125"></line><line x1="80" y1="211.125" x2="141" y2="170.125"></line><line x1="141" y1="170.125" x2="169" y2="327.125"></line><line x1="209" y1="119.125" x2="45" y2="161.125"></line><line x1="209" y1="119.125" x2="260" y2="138.125"></line><line x1="260" y1="138.125" x2="141" y2="170.125"></line><line x1="80" y1="211.125" x2="169" y2="327.125"></line><line x1="133" y1="77.125" x2="45" y2="161.125"></line><line x1="133" y1="77.125" x2="209" y2="119.125"></line><line x1="266" y1="286.125" x2="141" y2="170.125"></line><line x1="262" y1="35.125" x2="133" y2="77.125"></line><line x1="322" y1="88.125" x2="262" y2="35.125"></line><line x1="262" y1="35.125" x2="340" y2="54.125"></line><line x1="414" y1="48.125" x2="322" y2="88.125"></line><line x1="340" y1="54.125" x2="414" y2="48.125"></line><line x1="348" y1="289.125" x2="266" y2="286.125"></line><line x1="288" y1="222.125" x2="322" y2="88.125"></line><line x1="289" y1="390.125" x2="348" y2="289.125"></line><line x1="417" y1="305.125" x2="288" y2="222.125"></line><line x1="310" y1="207.125" x2="417" y2="305.125"></line><line x1="449" y1="266.125" x2="310" y2="207.125"></line><line x1="387" y1="115.125" x2="449" y2="266.125"></line><line x1="513" y1="281.125" x2="289" y2="390.125"></line><line x1="586" y1="166.125" x2="387" y2="115.125"></line><line x1="433" y1="153.125" x2="513" y2="281.125"></line><line x1="433" y1="153.125" x2="586" y2="166.125"></line></g><g><circle cx="45" cy="161.125" r="5" class="dot"></circle><circle cx="80" cy="211.125" r="5" class="dot"></circle><circle cx="141" cy="170.125" r="5" class="dot"></circle><circle cx="169" cy="327.125" r="5" class="dot"></circle><circle cx="260" cy="138.125" r="5" class="dot"></circle><circle cx="209" cy="119.125" r="5" class="dot"></circle><circle cx="133" cy="77.125" r="5" class="dot"></circle><circle cx="266" cy="286.125" r="5" class="dot"></circle><circle cx="262" cy="35.125" r="5" class="dot"></circle><circle cx="340" cy="54.125" r="5" class="dot"></circle><circle cx="322" cy="88.125" r="5" class="dot"></circle><circle cx="414" cy="48.125" r="5" class="dot"></circle><circle cx="348" cy="289.125" r="5" class="dot"></circle><circle cx="288" cy="222.125" r="5" class="dot"></circle><circle cx="289" cy="390.125" r="5" class="dot"></circle><circle cx="417" cy="305.125" r="5" class="dot"></circle><circle cx="310" cy="207.125" r="5" class="dot"></circle><circle cx="449" cy="266.125" r="5" class="dot"></circle><circle cx="387" cy="115.125" r="5" class="dot"></circle><circle cx="513" cy="281.125" r="5" class="dot"></circle><circle cx="433" cy="153.125" r="5" class="dot"></circle><circle cx="586" cy="166.125" r="5" class="dot"></circle></g></svg>

  <p>Planar point location is the problem of quickly determining which polygon each of a series of queries is in.  Imagine throwing darts at the horrible mess to the right, how could you quickly search for what they hit?  Because there are potentially many queries, we want to preprocess the graph to ensure fast querying with minimal memory overhead.  The algorithm here (first presented by Sarnak and Tarjan in Planar Point Location Using Persistent Search Trees), is to store the edges of the planar graph in a partially persistent binary search tree.  Because it is a BST, queries and updates can be done in O(logn) time, and thanks to a fancy trick and amortized analysis the entire tree only requires O(n) space.</p>
  </div>
  <br clear="both"/>
  <div class="p">
  <svg width="400" height="125" class="left"><g><line x1="18" x2="18" y1="0" y2="400" class="slabWall"></line><line x1="48" x2="48" y1="0" y2="400" class="slabWall"></line><line x1="77" x2="77" y1="0" y2="400" class="slabWall"></line><line x1="48" x2="48" y1="0" y2="400" class="slabWall"></line><line x1="85" x2="85" y1="0" y2="400" class="slabWall"></line><line x1="86" x2="86" y1="0" y2="400" class="slabWall"></line><line x1="86" x2="86" y1="0" y2="400" class="slabWall"></line><line x1="111" x2="111" y1="0" y2="400" class="slabWall"></line><line x1="111" x2="111" y1="0" y2="400" class="slabWall"></line><line x1="132" x2="132" y1="0" y2="400" class="slabWall"></line><line x1="132" x2="132" y1="0" y2="400" class="slabWall"></line><line x1="153" x2="153" y1="0" y2="400" class="slabWall"></line><line x1="153" x2="153" y1="0" y2="400" class="slabWall"></line><line x1="175" x2="175" y1="0" y2="400" class="slabWall"></line><line x1="179" x2="179" y1="0" y2="400" class="slabWall"></line><line x1="202" x2="202" y1="0" y2="400" class="slabWall"></line><line x1="176" x2="176" y1="0" y2="400" class="slabWall"></line><line x1="200" x2="200" y1="0" y2="400" class="slabWall"></line><line x1="13" x2="13" y1="0" y2="400" class="slabWall"></line><line x1="265" x2="265" y1="0" y2="400" class="slabWall"></line><line x1="220" x2="220" y1="0" y2="400" class="slabWall"></line><line x1="223" x2="223" y1="0" y2="400" class="slabWall"></line></g><g></g><g><line x1="18" y1="10.125" x2="48" y2="10.125"></line><line x1="48" y1="10.125" x2="77" y2="9.125"></line><line x1="48" y1="68.125" x2="48" y2="10.125"></line><line x1="86" y1="42.125" x2="85" y2="69.125"></line><line x1="153" y1="69.125" x2="153" y2="42.125"></line><line x1="153" y1="42.125" x2="132" y2="41.125"></line><line x1="132" y1="41.125" x2="132" y2="69.125"></line><line x1="132" y1="41.125" x2="111" y2="41.125"></line><line x1="111" y1="41.125" x2="111" y2="69.125"></line><line x1="200" y1="44.125" x2="175" y2="41.125"></line><line x1="200" y1="44.125" x2="176" y2="51.125"></line><line x1="176" y1="51.125" x2="179" y2="69.125"></line><line x1="179" y1="69.125" x2="202" y2="66.125"></line><line x1="265" y1="92.125" x2="13" y2="94.125"></line><line x1="223" y1="116.125" x2="265" y2="92.125"></line><line x1="265" y1="92.125" x2="220" y2="67.125"></line></g><g><circle cx="18" cy="10.125" r="5" class="dot"></circle><circle cx="48" cy="10.125" r="5" class="dot"></circle><circle cx="77" cy="9.125" r="5" class="dot"></circle><circle cx="48" cy="68.125" r="5" class="dot"></circle><circle cx="85" cy="69.125" r="5" class="dot"></circle><circle cx="86" cy="42.125" r="5" class="dot"></circle><circle cx="86" cy="25.125" r="5" class="dot"></circle><circle cx="111" cy="69.125" r="5" class="dot"></circle><circle cx="111" cy="41.125" r="5" class="dot"></circle><circle cx="132" cy="41.125" r="5" class="dot"></circle><circle cx="132" cy="69.125" r="5" class="dot"></circle><circle cx="153" cy="42.125" r="5" class="dot"></circle><circle cx="153" cy="69.125" r="5" class="dot"></circle><circle cx="175" cy="41.125" r="5" class="dot"></circle><circle cx="179" cy="69.125" r="5" class="dot"></circle><circle cx="202" cy="66.125" r="5" class="dot"></circle><circle cx="176" cy="51.125" r="5" class="dot"></circle><circle cx="200" cy="44.125" r="5" class="dot"></circle><circle cx="13" cy="94.125" r="5" class="dot"></circle><circle cx="265" cy="92.125" r="5" class="dot"></circle><circle cx="220" cy="67.125" r="5" class="dot"></circle><circle cx="223" cy="116.125" r="5" class="dot"></circle></g></svg>
  <p>The key insight of this approach is to treat one dimension (of the 2D point location problem) as time.  That is, instead of thinking of line segments in the planar graph as being line segments, think of them as the path taken by a moving point over a finite duration.  In this view, one end of the line segment represents where and when the point came into being and the other end represents when the point blinked out of existence forever.  Queries take on a temporal flavor as well, they amount to simply asking where would a given 1D point fall in the tree if it was queried at a given time in the tree's history.</p>
  </div>
  <!-- <br clear="both"/> -->
  <div class="p">
  <svg width="700" height="385" class="right"><g><line x1="110" x2="110" y1="0" y2="400" class="slabWall"></line><line x1="89" x2="89" y1="0" y2="400" class="slabWall"></line><line x1="62" x2="62" y1="0" y2="400" class="slabWall"></line><line x1="79" x2="79" y1="0" y2="400" class="slabWall"></line><line x1="100" x2="100" y1="0" y2="400" class="slabWall"></line><line x1="553" x2="553" y1="0" y2="400" class="slabWall"></line><line x1="577" x2="577" y1="0" y2="400" class="slabWall"></line><line x1="600" x2="600" y1="0" y2="400" class="slabWall"></line><line x1="624" x2="624" y1="0" y2="400" class="slabWall"></line><line x1="646" x2="646" y1="0" y2="400" class="slabWall"></line><line x1="670" x2="670" y1="0" y2="400" class="slabWall"></line></g><g><path d="M132.5 120.42215302491103C231.875 120.42215302491103 165.625 192.11441798941797 265 192.11441798941797" class="rbtLink"></path><path d="M265 192.11441798941797C364.375 192.11441798941797 298.125 269.8925438596491 397.5 269.8925438596491" class="rbtLink"></path><path d="M397.5 269.8925438596491C496.875 269.8925438596491 430.625 259.85393772893775 530 259.85393772893775" class="rbtLink"></path><path d="M265 192.11441798941797C364.375 192.11441798941797 298.125 186.94243119266054 397.5 186.94243119266054" class="rbtLink"></path><path d="M132.5 120.42215302491103C231.875 120.42215302491103 165.625 101.54574363992171 265 101.54574363992171" class="rbtLink"></path><path d="M265 101.54574363992171C364.375 101.54574363992171 298.125 131.44563197026022 397.5 131.44563197026022" class="rbtLink"></path><path d="M265 101.54574363992171C364.375 101.54574363992171 298.125 65.67210920770879 397.5 65.67210920770879" class="rbtLink"></path><path d="M397.5 65.67210920770879C496.875 65.67210920770879 430.625 79.02868852459017 530 79.02868852459017" class="rbtLink"></path><path d="M397.5 65.67210920770879C496.875 65.67210920770879 430.625 13.786399548532728 530 13.786399548532728" class="rbtLink"></path></g><g><line x1="110" y1="44.125" x2="553" y2="12.125"></line><line x1="110" y1="44.125" x2="577" y2="79.125"></line><line x1="577" y1="79.125" x2="89" y2="78.125"></line><line x1="89" y1="78.125" x2="600" y2="146.125"></line><line x1="600" y1="146.125" x2="62" y2="107.125"></line><line x1="62" y1="107.125" x2="624" y2="213.125"></line><line x1="624" y1="213.125" x2="79" y2="150.125"></line><line x1="79" y1="150.125" x2="646" y2="278.125"></line><line x1="646" y1="278.125" x2="100" y2="192.125"></line><line x1="670" y1="341.125" x2="100" y2="192.125"></line></g><g><circle cx="110" cy="44.125" r="5" class="dot"></circle><circle cx="89" cy="78.125" r="5" class="dot"></circle><circle cx="62" cy="107.125" r="5" class="dot"></circle><circle cx="79" cy="150.125" r="5" class="dot"></circle><circle cx="100" cy="192.125" r="5" class="dot"></circle><circle cx="553" cy="12.125" r="5" class="dot"></circle><circle cx="577" cy="79.125" r="5" class="dot"></circle><circle cx="600" cy="146.125" r="5" class="dot"></circle><circle cx="624" cy="213.125" r="5" class="dot"></circle><circle cx="646" cy="278.125" r="5" class="dot"></circle><circle cx="670" cy="341.125" r="5" class="dot"></circle></g></svg>
  <p>The challenge then becomes, how can we build a search tree that respects the behavior of time?  To simplify the problem, note that changes to the data structure will only occur at vertcies of the graph.  During intermediate times the points stored in the tree will move, but because the graph is planar they will never cross, so the only modification that is required is to store the slope (if you're thinking in 2 spatial dimensions, otherwise think of it as storing the point's speed) of each edge in the tree along side the starting point (and a modification to use that information when searching).  If the queries were guaranteed to come in order we'd be done, we could maintain an ephemeral (ie non-persistent) search tree as we query, adding and removing edges as we proceed chronologically through the list of queries.  Unfortunately this is one assumption that we cannot make, so we'll need to give our search tree some memory by making it persistent. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[the binary search tree for a query at some point in this middle slab]</p>
  </div>
  <!-- <br clear="both"/> -->
  <div class="p">
  <p>Data structures are called persistent when  all of their past states can still be accessed via a time parameter.  To take the most popular example, version control systems store changing data, but they are persistent because you can always revert to previous versions of their contents.  They work by maintaining a collection of head pointers with timestamps, where each item pointed to by the head may have been edited at the current time or any previous time.  When an item is added or removed the search path from the current head to the new (or old) node is copied except that the copy reflects the addition or removal, the head of the copied path is associated with the time of the modification and added to the collection of heads.</p>
  </div>
  <!-- <br clear="both"/> -->
  <div class="p">
  <svg width="400" height="200" class="editMode left"><g><line x1="169" x2="169" y1="0" y2="400" class="slabWall"></line><line x1="99" x2="99" y1="0" y2="400" class="slabWall"></line><line x1="244" x2="244" y1="0" y2="400" class="slabWall"></line><line x1="37" x2="37" y1="0" y2="400" class="slabWall"></line><line x1="136" x2="136" y1="0" y2="400" class="slabWall"></line><line x1="207" x2="207" y1="0" y2="400" class="slabWall"></line><line x1="295" x2="295" y1="0" y2="400" class="slabWall"></line><line x1="10" x2="10" y1="0" y2="400" class="slabWall"></line><line x1="60" x2="60" y1="0" y2="400" class="slabWall"></line><line x1="76" x2="76" y1="0" y2="400" class="slabWall"></line><line x1="68" x2="68" y1="0" y2="400" class="slabWall"></line><line x1="88" x2="88" y1="0" y2="400" class="slabWall"></line><line x1="307" x2="307" y1="0" y2="400" class="slabWall"></line><line x1="316" x2="316" y1="0" y2="400" class="slabWall"></line><line x1="334" x2="334" y1="0" y2="400" class="slabWall"></line></g><g></g><g><line x1="169" y1="6.125" x2="99" y2="57.125"></line><line x1="99" y1="57.125" x2="37" y2="106.125"></line><line x1="99" y1="57.125" x2="136" y2="104.125"></line><line x1="37" y1="106.125" x2="10" y2="140.125"></line><line x1="37" y1="106.125" x2="60" y2="140.125"></line><line x1="37" y1="106.125" x2="76" y2="140.125"></line><line x1="76" y1="140.125" x2="68" y2="175.125"></line><line x1="60" y1="140.125" x2="88" y2="176.125"></line><line x1="76" y1="140.125" x2="88" y2="176.125"></line><line x1="169" y1="6.125" x2="244" y2="54.125"></line><line x1="244" y1="54.125" x2="207" y2="104.125"></line><line x1="244" y1="54.125" x2="295" y2="98.125"></line><line x1="295" y1="98.125" x2="307" y2="126.125"></line><line x1="295" y1="98.125" x2="316" y2="80.125"></line><line x1="316" y1="80.125" x2="334" y2="98.125"></line><line x1="244" y1="54.125" x2="316" y2="80.125"></line></g><g><circle cx="169" cy="6.125" r="5" class="dot"></circle><circle cx="99" cy="57.125" r="5" class="dot"></circle><circle cx="244" cy="54.125" r="5" class="dot"></circle><circle cx="37" cy="106.125" r="5" class="dot"></circle><circle cx="136" cy="104.125" r="5" class="dot"></circle><circle cx="207" cy="104.125" r="5" class="dot"></circle><circle cx="295" cy="98.125" r="5" class="dot"></circle><circle cx="10" cy="140.125" r="5" class="dot"></circle><circle cx="60" cy="140.125" r="5" class="dot"></circle><circle cx="76" cy="140.125" r="5" class="dot"></circle><circle cx="68" cy="175.125" r="5" class="dot"></circle><circle cx="88" cy="176.125" r="5" class="dot"></circle><circle cx="307" cy="126.125" r="5" class="dot"></circle><circle cx="316" cy="80.125" r="5" class="dot"></circle><circle cx="334" cy="98.125" r="5" class="dot"></circle></g></svg>
  <p>In our case we're using a binary search tree that has been modified to be partially persistent, which is to say that only the most recent head can be modified, because it allows for a better space bound.  The space savings is achieved by not copying the entire O(logn) search path with each modification.  Instead to each node we add a third pointer and a timestamp, and when it comes time to modify one of the node's children the pointer to the new child is stored in the third pointer slot and the timestamp at which the modifiation took place is recorded as well.  If the third pointer is already used (so an update would require a fourth pointer), the node's contained edge is instead copied into a new node that points to the appropriate children nodes and has an empty third pointer.  This limited node copying drops the amortized space cost of a modification to O(1) (which is intuitive since restoring the invariants after modifying an ephemeral red black tree requires O(1) pointer changes), so the overall space is O(n) for n edges.</p>
  </div>
  <div class="p">
  <svg width="700" height="400" class="right"><g><line x1="45" x2="45" y1="0" y2="400" class="slabWall"></line><line x1="80" x2="80" y1="0" y2="400" class="slabWall"></line><line x1="141" x2="141" y1="0" y2="400" class="slabWall"></line><line x1="169" x2="169" y1="0" y2="400" class="slabWall"></line><line x1="260" x2="260" y1="0" y2="400" class="slabWall"></line><line x1="209" x2="209" y1="0" y2="400" class="slabWall"></line><line x1="133" x2="133" y1="0" y2="400" class="slabWall"></line><line x1="266" x2="266" y1="0" y2="400" class="slabWall"></line><line x1="262" x2="262" y1="0" y2="400" class="slabWall"></line><line x1="340" x2="340" y1="0" y2="400" class="slabWall"></line><line x1="322" x2="322" y1="0" y2="400" class="slabWall"></line><line x1="414" x2="414" y1="0" y2="400" class="slabWall"></line><line x1="348" x2="348" y1="0" y2="400" class="slabWall"></line><line x1="288" x2="288" y1="0" y2="400" class="slabWall"></line><line x1="289" x2="289" y1="0" y2="400" class="slabWall"></line><line x1="417" x2="417" y1="0" y2="400" class="slabWall"></line><line x1="310" x2="310" y1="0" y2="400" class="slabWall"></line><line x1="449" x2="449" y1="0" y2="400" class="slabWall"></line><line x1="387" x2="387" y1="0" y2="400" class="slabWall"></line><line x1="513" x2="513" y1="0" y2="400" class="slabWall"></line><line x1="433" x2="433" y1="0" y2="400" class="slabWall"></line><line x1="586" x2="586" y1="0" y2="400" class="slabWall"></line></g><g><path d="M141 170.125C163.5 170.125 148.5 197.965 171 197.965" class="rbtLink"></path><path d="M141 170.125C163.5 170.125 148.5 98.12500000000001 171 98.12500000000001" class="rbtLink"></path><path d="M171 98.12500000000001C193.5 98.12500000000001 178.5 121.17378048780489 201 121.17378048780489" class="rbtLink"></path><path d="M171 98.12500000000001C193.5 98.12500000000001 178.5 54.98546511627907 201 54.98546511627907" class="rbtLink"></path></g><g><line x1="141" y1="170.125" x2="45" y2="161.125"></line><line x1="45" y1="161.125" x2="80" y2="211.125"></line><line x1="80" y1="211.125" x2="141" y2="170.125"></line><line x1="141" y1="170.125" x2="169" y2="327.125"></line><line x1="209" y1="119.125" x2="45" y2="161.125"></line><line x1="209" y1="119.125" x2="260" y2="138.125"></line><line x1="260" y1="138.125" x2="141" y2="170.125"></line><line x1="80" y1="211.125" x2="169" y2="327.125"></line><line x1="133" y1="77.125" x2="45" y2="161.125"></line><line x1="133" y1="77.125" x2="209" y2="119.125"></line><line x1="266" y1="286.125" x2="141" y2="170.125"></line><line x1="262" y1="35.125" x2="133" y2="77.125"></line><line x1="322" y1="88.125" x2="262" y2="35.125"></line><line x1="262" y1="35.125" x2="340" y2="54.125"></line><line x1="414" y1="48.125" x2="322" y2="88.125"></line><line x1="340" y1="54.125" x2="414" y2="48.125"></line><line x1="348" y1="289.125" x2="266" y2="286.125"></line><line x1="288" y1="222.125" x2="322" y2="88.125"></line><line x1="289" y1="390.125" x2="348" y2="289.125"></line><line x1="417" y1="305.125" x2="288" y2="222.125"></line><line x1="310" y1="207.125" x2="417" y2="305.125"></line><line x1="449" y1="266.125" x2="310" y2="207.125"></line><line x1="387" y1="115.125" x2="449" y2="266.125"></line><line x1="513" y1="281.125" x2="289" y2="390.125"></line><line x1="586" y1="166.125" x2="387" y2="115.125"></line><line x1="433" y1="153.125" x2="513" y2="281.125"></line><line x1="433" y1="153.125" x2="586" y2="166.125"></line></g><g><circle cx="45" cy="161.125" r="5" class="dot"></circle><circle cx="80" cy="211.125" r="5" class="dot"></circle><circle cx="141" cy="170.125" r="5" class="dot"></circle><circle cx="169" cy="327.125" r="5" class="dot"></circle><circle cx="260" cy="138.125" r="5" class="dot"></circle><circle cx="209" cy="119.125" r="5" class="dot"></circle><circle cx="133" cy="77.125" r="5" class="dot"></circle><circle cx="266" cy="286.125" r="5" class="dot"></circle><circle cx="262" cy="35.125" r="5" class="dot"></circle><circle cx="340" cy="54.125" r="5" class="dot"></circle><circle cx="322" cy="88.125" r="5" class="dot"></circle><circle cx="414" cy="48.125" r="5" class="dot"></circle><circle cx="348" cy="289.125" r="5" class="dot"></circle><circle cx="288" cy="222.125" r="5" class="dot"></circle><circle cx="289" cy="390.125" r="5" class="dot"></circle><circle cx="417" cy="305.125" r="5" class="dot"></circle><circle cx="310" cy="207.125" r="5" class="dot"></circle><circle cx="449" cy="266.125" r="5" class="dot"></circle><circle cx="387" cy="115.125" r="5" class="dot"></circle><circle cx="513" cy="281.125" r="5" class="dot"></circle><circle cx="433" cy="153.125" r="5" class="dot"></circle><circle cx="586" cy="166.125" r="5" class="dot"></circle></g></svg>
  <p>So, with all of that in mind, when you draw a planar graph above and click Toggle Query Mode, here's what happens.  Behind the scenes when you click the button each edge is paired with a start time, and again with a stop time, these 2n events are then sorted chronologically (that is, by horizontal coordinate of the event (point) in the graph) and applied to a partially persistent red black tree.  Then, as you move the mouse across the graph it draws the tree as it existed at the time corresponding to the position of the cursor.  The horizontal parts of the curvy tree intersect with the edges that that branch of the tree represents.</p>
  <p>For each query two binary searches are run: the first is a binary search through time to determine which slab (delineated by the vertical gray lines) contains the query (cursor).  These slabs represent the insertions and deletions, which is to say, if the binary search tree were fully persistent the slabs would correspond with the O(n) heads of the tree.  The second binary search is then searching within the tree as it existed during the slab (of time) to locate the highest edge below the query point.  Given the highest edge below the query it's easy to determine which polygon contains the query: just associate with each edge the identity of the polygon it constitutes a lower edge of.</p>
  <h3>Future Work</h3>
  <ul>
    <li>Right now it doesn't show either of the two binary searches to locate the mouse, it probably ought to.</li>
  	<li>I spent entirely too much time chasing stupid issues (eg forgetting to enforce general position, coding as if a type checker had my back, forgetting an @ before a variable, etc), and ultimately there wasn't time to actually implement the optimal time bound from the paper.</li>
  	<li>Right now there's no clean way to illustrate the fact that the red black tree is in fact persistent, instead the user has to move the mouse and trust that things aren't being recomputed unnecessarily... or alternatively they could press 'a' and learn to read my debugging format.</li>
  	<li>Right now the red black tree doesn't rebalance after deletions and cursory attempts to add that failed (see above regarding the lack of a type checker).</li>
  </ul>
  <h3>Gallery</h3>
  Greg's torture test:<br/>
  <svg width="700" height="400" class=""><g><line x1="45" x2="45" y1="0" y2="400" class="slabWall"></line><line x1="80" x2="80" y1="0" y2="400" class="slabWall"></line><line x1="141" x2="141" y1="0" y2="400" class="slabWall"></line><line x1="169" x2="169" y1="0" y2="400" class="slabWall"></line><line x1="260" x2="260" y1="0" y2="400" class="slabWall"></line><line x1="209" x2="209" y1="0" y2="400" class="slabWall"></line><line x1="133" x2="133" y1="0" y2="400" class="slabWall"></line><line x1="266" x2="266" y1="0" y2="400" class="slabWall"></line><line x1="262" x2="262" y1="0" y2="400" class="slabWall"></line><line x1="340" x2="340" y1="0" y2="400" class="slabWall"></line><line x1="322" x2="322" y1="0" y2="400" class="slabWall"></line><line x1="414" x2="414" y1="0" y2="400" class="slabWall"></line><line x1="348" x2="348" y1="0" y2="400" class="slabWall"></line><line x1="288" x2="288" y1="0" y2="400" class="slabWall"></line><line x1="289" x2="289" y1="0" y2="400" class="slabWall"></line><line x1="417" x2="417" y1="0" y2="400" class="slabWall"></line><line x1="310" x2="310" y1="0" y2="400" class="slabWall"></line><line x1="449" x2="449" y1="0" y2="400" class="slabWall"></line><line x1="387" x2="387" y1="0" y2="400" class="slabWall"></line><line x1="513" x2="513" y1="0" y2="400" class="slabWall"></line><line x1="433" x2="433" y1="0" y2="400" class="slabWall"></line><line x1="586" x2="586" y1="0" y2="400" class="slabWall"></line></g><g><path d="M310 207.125C329.125 207.125 316.375 252.68701550387595 335.5 252.68701550387595" class="rbtLink"></path><path d="M335.5 252.68701550387595C354.625 252.68701550387595 341.875 355.08928571428567 361 355.08928571428567" class="rbtLink"></path><path d="M310 207.125C329.125 207.125 316.375 217.94874100719426 335.5 217.94874100719426" class="rbtLink"></path><path d="M335.5 217.94874100719426C354.625 217.94874100719426 341.875 71.16847826086956 361 71.16847826086956" class="rbtLink"></path><path d="M361 71.16847826086956C380.5 71.16847826086956 367.5 115.125 387 115.125" class="rbtLink"></path><path d="M387 115.125C405.75 115.125 393.25 176.01209677419365 412 176.01209677419365" class="rbtLink"></path><path d="M361 71.16847826086956C380.125 71.16847826086956 367.375 50.354729729729726 386.5 50.354729729729726" class="rbtLink"></path></g><g><line x1="141" y1="170.125" x2="45" y2="161.125"></line><line x1="45" y1="161.125" x2="80" y2="211.125"></line><line x1="80" y1="211.125" x2="141" y2="170.125"></line><line x1="141" y1="170.125" x2="169" y2="327.125"></line><line x1="209" y1="119.125" x2="45" y2="161.125"></line><line x1="209" y1="119.125" x2="260" y2="138.125"></line><line x1="260" y1="138.125" x2="141" y2="170.125"></line><line x1="80" y1="211.125" x2="169" y2="327.125"></line><line x1="133" y1="77.125" x2="45" y2="161.125"></line><line x1="133" y1="77.125" x2="209" y2="119.125"></line><line x1="266" y1="286.125" x2="141" y2="170.125"></line><line x1="262" y1="35.125" x2="133" y2="77.125"></line><line x1="322" y1="88.125" x2="262" y2="35.125"></line><line x1="262" y1="35.125" x2="340" y2="54.125"></line><line x1="414" y1="48.125" x2="322" y2="88.125"></line><line x1="340" y1="54.125" x2="414" y2="48.125"></line><line x1="348" y1="289.125" x2="266" y2="286.125"></line><line x1="288" y1="222.125" x2="322" y2="88.125"></line><line x1="289" y1="390.125" x2="348" y2="289.125"></line><line x1="417" y1="305.125" x2="288" y2="222.125"></line><line x1="310" y1="207.125" x2="417" y2="305.125"></line><line x1="449" y1="266.125" x2="310" y2="207.125"></line><line x1="387" y1="115.125" x2="449" y2="266.125"></line><line x1="513" y1="281.125" x2="289" y2="390.125"></line><line x1="586" y1="166.125" x2="387" y2="115.125"></line><line x1="433" y1="153.125" x2="513" y2="281.125"></line><line x1="433" y1="153.125" x2="586" y2="166.125"></line></g><g><circle cx="45" cy="161.125" r="5" class="dot"></circle><circle cx="80" cy="211.125" r="5" class="dot"></circle><circle cx="141" cy="170.125" r="5" class="dot"></circle><circle cx="169" cy="327.125" r="5" class="dot"></circle><circle cx="260" cy="138.125" r="5" class="dot"></circle><circle cx="209" cy="119.125" r="5" class="dot"></circle><circle cx="133" cy="77.125" r="5" class="dot"></circle><circle cx="266" cy="286.125" r="5" class="dot"></circle><circle cx="262" cy="35.125" r="5" class="dot"></circle><circle cx="340" cy="54.125" r="5" class="dot"></circle><circle cx="322" cy="88.125" r="5" class="dot"></circle><circle cx="414" cy="48.125" r="5" class="dot"></circle><circle cx="348" cy="289.125" r="5" class="dot"></circle><circle cx="288" cy="222.125" r="5" class="dot"></circle><circle cx="289" cy="390.125" r="5" class="dot"></circle><circle cx="417" cy="305.125" r="5" class="dot"></circle><circle cx="310" cy="207.125" r="5" class="dot"></circle><circle cx="449" cy="266.125" r="5" class="dot"></circle><circle cx="387" cy="115.125" r="5" class="dot"></circle><circle cx="513" cy="281.125" r="5" class="dot"></circle><circle cx="433" cy="153.125" r="5" class="dot"></circle><circle cx="586" cy="166.125" r="5" class="dot"></circle></g></svg>
  <br/>
  M@'s not so torturous test:<br/>
  <svg width="700" height="400" class=""><g><line x1="110" x2="110" y1="0" y2="400" class="slabWall"></line><line x1="89" x2="89" y1="0" y2="400" class="slabWall"></line><line x1="62" x2="62" y1="0" y2="400" class="slabWall"></line><line x1="79" x2="79" y1="0" y2="400" class="slabWall"></line><line x1="100" x2="100" y1="0" y2="400" class="slabWall"></line><line x1="553" x2="553" y1="0" y2="400" class="slabWall"></line><line x1="577" x2="577" y1="0" y2="400" class="slabWall"></line><line x1="600" x2="600" y1="0" y2="400" class="slabWall"></line><line x1="624" x2="624" y1="0" y2="400" class="slabWall"></line><line x1="646" x2="646" y1="0" y2="400" class="slabWall"></line><line x1="670" x2="670" y1="0" y2="400" class="slabWall"></line></g><g><path d="M132.5 120.42215302491103C231.875 120.42215302491103 165.625 192.11441798941797 265 192.11441798941797" class="rbtLink"></path><path d="M265 192.11441798941797C364.375 192.11441798941797 298.125 269.8925438596491 397.5 269.8925438596491" class="rbtLink"></path><path d="M397.5 269.8925438596491C496.875 269.8925438596491 430.625 259.85393772893775 530 259.85393772893775" class="rbtLink"></path><path d="M265 192.11441798941797C364.375 192.11441798941797 298.125 186.94243119266054 397.5 186.94243119266054" class="rbtLink"></path><path d="M132.5 120.42215302491103C231.875 120.42215302491103 165.625 101.54574363992171 265 101.54574363992171" class="rbtLink"></path><path d="M265 101.54574363992171C364.375 101.54574363992171 298.125 131.44563197026022 397.5 131.44563197026022" class="rbtLink"></path><path d="M265 101.54574363992171C364.375 101.54574363992171 298.125 65.67210920770879 397.5 65.67210920770879" class="rbtLink"></path><path d="M397.5 65.67210920770879C496.875 65.67210920770879 430.625 79.02868852459017 530 79.02868852459017" class="rbtLink"></path><path d="M397.5 65.67210920770879C496.875 65.67210920770879 430.625 13.786399548532728 530 13.786399548532728" class="rbtLink"></path></g><g><line x1="110" y1="44.125" x2="553" y2="12.125"></line><line x1="110" y1="44.125" x2="577" y2="79.125"></line><line x1="577" y1="79.125" x2="89" y2="78.125"></line><line x1="89" y1="78.125" x2="600" y2="146.125"></line><line x1="600" y1="146.125" x2="62" y2="107.125"></line><line x1="62" y1="107.125" x2="624" y2="213.125"></line><line x1="624" y1="213.125" x2="79" y2="150.125"></line><line x1="79" y1="150.125" x2="646" y2="278.125"></line><line x1="646" y1="278.125" x2="100" y2="192.125"></line><line x1="670" y1="341.125" x2="100" y2="192.125"></line></g><g><circle cx="110" cy="44.125" r="5" class="dot"></circle><circle cx="89" cy="78.125" r="5" class="dot"></circle><circle cx="62" cy="107.125" r="5" class="dot"></circle><circle cx="79" cy="150.125" r="5" class="dot"></circle><circle cx="100" cy="192.125" r="5" class="dot"></circle><circle cx="553" cy="12.125" r="5" class="dot"></circle><circle cx="577" cy="79.125" r="5" class="dot"></circle><circle cx="600" cy="146.125" r="5" class="dot"></circle><circle cx="624" cy="213.125" r="5" class="dot"></circle><circle cx="646" cy="278.125" r="5" class="dot"></circle><circle cx="670" cy="341.125" r="5" class="dot"></circle></g></svg>

</body>
</html>